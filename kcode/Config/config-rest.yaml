# KCode v2 é…ç½®ç¤ºä¾‹ - REST æ¨¡å¼
# è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„é…ç½®ç¤ºä¾‹ï¼Œå±•ç¤º v2 æ¶æ„çš„æ ¸å¿ƒåŠŸèƒ½

app:
  name: "kcode"
  version: "2.0.0"
  workspace: "KCode"
  working_directory: "D:\\Repos\\kcode"
  header_welcome: "æ¬¢è¿å›æ¥ï¼"
  prompt_placeholder: "è¾“å…¥å‘½ä»¤ï¼Œä¾‹å¦‚ help"
  slogan: "ç°ä»£åŒ–å‘½ä»¤è¡Œ CNC æ§åˆ¶ç»ˆç«¯"
  suggestion_text: "Try \"/help\" to list commands."
  branch: "main"
  tokens: "0 tokens"
  permissions: "v2 mode"

# ä¼ è¾“å±‚é…ç½® - REST æ¨¡å¼
transport:
  type: "rest"
  base_url: "http://localhost:5000/api/v1/cnc"
  timeout_ms: 5000

  # è®¤è¯é…ç½® (å¯é€‰) - æµ‹è¯• API ä¸éœ€è¦è®¤è¯
  # auth:
  #   type: "bearer"
  #   token: "${CNC_API_TOKEN}"

  # è¯·æ±‚å¤´ (å¯é€‰)
  headers:
    Content-Type: "application/json"
    X-Client: "kcode-v2"

  # REST ç«¯ç‚¹å®šä¹‰
  endpoints:
    execute:
      method: "POST"
      path: "/execute"
      request:
        body:
          text: "string"
      response:
        success: "$.success"
        message: "$.message"

    get_status:
      method: "GET"
      path: "/status"
      response:
        x: "$.data.X"
        y: "$.data.Y"
        z: "$.data.Z"
        feed: "$.data.Feed"
        speed: "$.data.Speed"
        state: "$.data.State"
        alarm: "$.data.Alarm"
        temp: "$.data.Temp"

    # è½®è¯¢æ¨¡å¼ (ç”¨äºå®æ—¶çŠ¶æ€)
    poll_status:
      method: "GET"
      path: "/status"
      polling:
        enabled: true
        interval_ms: 1000
      response:
        x: "$.data.X"
        y: "$.data.Y"
        z: "$.data.Z"
        feed: "$.data.Feed"
        speed: "$.data.Speed"
        state: "$.data.State"
        temp: "$.data.Temp"

    get_parameters:
      method: "GET"
      path: "/params"
      response:
        parameters: "$.data"

    set_parameter:
      method: "POST"
      path: "/set_param"
      request:
        body:
          key: "string"
          value: "double"
      response:
        success: "$.success"
        message: "$.message"

    estop:
      method: "POST"
      path: "/emergency_stop"
      response:
        success: "$.success"
        message: "$.message"

    reset:
      method: "POST"
      path: "/reset"
      response:
        success: "$.success"
        message: "$.message"

# API æ¥å£å®šä¹‰ (åè®®æ— å…³)
api:
  execute:
    description: "æ‰§è¡Œ G ä»£ç æˆ–å‘½ä»¤"
    request:
      text: "string"
    response:
      success: "bool"
      message: "string"

  stream_status:
    description: "è·å–æœºå™¨çŠ¶æ€æµ"
    stream: true
    response:
      x: "double"
      y: "double"
      z: "double"
      feed: "double"
      speed: "double"
      state: "string"
      alarm: "string"
      temp: "double"

# å‘½ä»¤ç³»ç»Ÿé…ç½®
commands:
  # ç³»ç»Ÿå‘½ä»¤
  system:
    help:
      aliases: ["?", "h"]
      description: "æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯"
      action: "builtin:help"

    exit:
      aliases: ["quit", "q"]
      description: "é€€å‡ºç¨‹åº"
      action: "builtin:exit"

    status:
      aliases: ["st"]
      description: "æ˜¾ç¤ºæœºå™¨çŠ¶æ€"
      action: "builtin:status_panel"

    clear:
      aliases: ["cls"]
      description: "æ¸…å±"
      action: "builtin:clear"

  # API å‘½ä»¤ (æ˜ å°„åˆ°åç«¯æ¥å£)
  api:
    # ç›´æ¥æ‰§è¡Œ G ä»£ç 
    gcode:
      pattern: "^[GMgm]\\d+.*"
      endpoint: "execute"
      request_mapping:
        text: "$input"
      response_template: |
        {{if .success}}
        [green]âœ“[/] {{.message}}
        {{else}}
        [red]âœ—[/] {{.message}}
        {{end}}

    # è®¾ç½®å‚æ•°
    set:
      pattern: "^/set\\s+(\\w+)\\s+([\\d.]+)$"
      description: "è®¾ç½®å‚æ•° /set <é”®> <å€¼>"
      endpoint: "set_parameter"
      request_mapping:
        key: "$1"
        value: "$2"
      response_template: |
        {{if .success}}
        [green]ğŸ“ å‚æ•°å·²æ›´æ–°[/]: {{.message}}
        {{else}}
        [red]âš ï¸ è®¾ç½®å¤±è´¥[/]: {{.message}}
        {{end}}

    # è·å–å‚æ•°åˆ—è¡¨
    params:
      aliases: ["parameters", "å‚æ•°"]
      description: "æ˜¾ç¤ºæ‰€æœ‰å‚æ•°"
      endpoint: "get_parameters"
      response_render: "table"

  # å®å‘½ä»¤ (å¤šæ­¥éª¤åºåˆ—)
  macros:
    home:
      aliases: ["home_all", "å›é›¶"]
      description: "æ‰€æœ‰è½´å›é›¶"
      steps:
        - endpoint: "execute"
          request:
            text: "G28"
      response_template: "[green]ğŸ  å›é›¶å®Œæˆ[/]"

    zero_work:
      aliases: ["æ¸…é›¶"]
      description: "è®¾ç½®å½“å‰ä½ç½®ä¸ºå·¥ä»¶é›¶ç‚¹"
      steps:
        - endpoint: "execute"
          request:
            text: "G10 L20 P1 X0 Y0 Z0"
      response_template: "[green]ğŸ“ å·¥ä»¶é›¶ç‚¹å·²è®¾ç½®[/]"

    auto_probe:
      aliases: ["å¯¹åˆ€"]
      description: "è‡ªåŠ¨å¯¹åˆ€"
      steps:
        - endpoint: "execute"
          request:
            text: "G91 G38.2 Z-50 F50"
        - endpoint: "execute"
          request:
            text: "G90 G10 L20 P1 Z0"
        - endpoint: "execute"
          request:
            text: "G91 G0 Z5"
      response_template: "[green]ğŸ”§ å¯¹åˆ€å®Œæˆ[/]"

  # åˆ«å (ç®€å•çš„å‘½ä»¤æ›¿æ¢)
  aliases:
    mv: "G0"
    rapid: "G0"
    feed: "G1"
    ä¸»è½´å¼€: "M3"
    ä¸»è½´å…³: "M5"
    å†·å´å¼€: "M8"
    å†·å´å…³: "M9"

  # å¿«æ·é”®ç»‘å®š
  shortcuts:
    Escape:
      action: "api:estop"
      feedback: "[red]ğŸš¨ ç´§æ€¥åœæ­¢![/]"

    Space:
      action: "api:feed_hold"
      feedback: "[yellow]â¸ï¸ è¿›ç»™ä¿æŒ[/]"

    F1:
      action: "builtin:help"

    F5:
      action: "builtin:status_panel"

# ä¸»é¢˜é…ç½®
theme:
  name: "Claude æš—è‰²"
  colors:
    background: "#000000"
    foreground: "#F4E3D7"
    accent_primary: "#FF7043"
    accent_secondary: "#4DD0E1"
    accent_tertiary: "#CE93D8"
    success: "#66BB6A"
    warning: "#FFEE58"
    error: "#EF5350"
    panel_border: "#FF7043"
    panel_divider: "#F57C00"
    header_text: "#F4E3D7"
    prompt_border: "#7E57C2"
    prompt_text: "#EDE7F6"
    footer_notice: "#FF4081"
    footer_badge: "#4DD0E1"
  icons:
    enabled: true
    set:
      success: "âœ“"
      error: "âœ—"
      warning: "âš "
      info: "â„¹"
      home: "ğŸ "
      tool: "ğŸ”§"
      temp: "ğŸŒ¡ï¸"
      speed: "ğŸš€"
      position: "ğŸ“"
      alarm: "ğŸš¨"
      pause: "â¸"
      play: "â–¶"
      stop: "â¹"
