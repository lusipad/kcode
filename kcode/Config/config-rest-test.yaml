# KCode v2 é…ç½® - REST æµ‹è¯•æ¨¡å¼
# è¿æ¥åˆ°æœ¬åœ°æµ‹è¯• API æœåŠ¡ (localhost:5000)

app:
  name: "kcode"
  version: "2.0.0"
  workspace: "KCode"
  working_directory: "D:\\Repos\\kcode"
  header_welcome: "æ¬¢è¿å›æ¥ï¼"
  prompt_placeholder: "è¾“å…¥å‘½ä»¤ï¼Œä¾‹å¦‚ help"
  slogan: "ç°ä»£åŒ–å‘½ä»¤è¡Œ CNC æ§åˆ¶ç»ˆç«¯"
  suggestion_text: "Try \"/help\" to list commands."
  branch: "main"
  tokens: "0 tokens"
  permissions: "v2 mode"

# ä¼ è¾“å±‚é…ç½® - REST æ¨¡å¼
transport:
  type: "rest"
  base_url: "http://localhost:5000/api/v1/cnc"
  timeout_ms: 5000

  # è¯·æ±‚å¤´
  headers:
    Content-Type: "application/json"
    X-Client: "kcode-v2-test"

  # REST ç«¯ç‚¹å®šä¹‰
  endpoints:
    execute:
      method: "POST"
      path: "/execute"
      request:
        body:
          text: "string"
      response:
        success: "$.success"
        message: "$.message"

    get_status:
      method: "GET"
      path: "/status"
      response:
        x: "$.data.X"
        y: "$.data.Y"
        z: "$.data.Z"
        feed: "$.data.Feed"
        speed: "$.data.Speed"
        state: "$.data.State"
        alarm: "$.data.Alarm"
        temp: "$.data.Temp"

    poll_status:
      method: "GET"
      path: "/status"
      polling:
        enabled: true
        interval_ms: 1000
      response:
        x: "$.data.X"
        y: "$.data.Y"
        z: "$.data.Z"
        feed: "$.data.Feed"
        speed: "$.data.Speed"
        state: "$.data.State"
        temp: "$.data.Temp"

    get_parameters:
      method: "GET"
      path: "/params"
      response:
        parameters: "$.data"

    set_parameter:
      method: "POST"
      path: "/set_param"
      request:
        body:
          key: "string"
          value: "double"
      response:
        success: "$.success"
        message: "$.message"

# å‘½ä»¤ç³»ç»Ÿé…ç½®
commands:
  # ç³»ç»Ÿå‘½ä»¤
  system:
    help:
      aliases: ["?", "h"]
      description: "æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯"
      action: "builtin:help"

    exit:
      aliases: ["quit", "q"]
      description: "é€€å‡ºç¨‹åº"
      action: "builtin:exit"

    status:
      aliases: ["st"]
      description: "æ˜¾ç¤ºæœºå™¨çŠ¶æ€"
      action: "builtin:status_panel"

    clear:
      aliases: ["cls"]
      description: "æ¸…å±"
      action: "builtin:clear"

  # API å‘½ä»¤
  api:
    # G ä»£ç æ‰§è¡Œ
    gcode:
      pattern: "^[GMgm]\\d+.*"
      endpoint: "execute"
      request_mapping:
        text: "$input"
      response_template: |
        {{if .success}}
        [green]âœ“[/] {{.message}}
        {{else}}
        [red]âœ—[/] {{.message}}
        {{end}}

    # è®¾ç½®å‚æ•°
    set:
      pattern: "^/set\\s+(\\w+)\\s+([\\d.]+)$"
      description: "è®¾ç½®å‚æ•° /set <é”®> <å€¼>"
      endpoint: "set_parameter"
      request_mapping:
        key: "$1"
        value: "$2"
      response_template: |
        {{if .success}}
        [green]ğŸ“ å‚æ•°å·²æ›´æ–°[/]: {{.message}}
        {{else}}
        [red]âš ï¸ è®¾ç½®å¤±è´¥[/]: {{.message}}
        {{end}}

    # è·å–å‚æ•°
    params:
      aliases: ["parameters"]
      description: "æ˜¾ç¤ºæ‰€æœ‰å‚æ•°"
      endpoint: "get_parameters"
      response_render: "table"

  # å®å‘½ä»¤
  macros:
    home:
      aliases: ["home_all", "å›é›¶"]
      description: "æ‰€æœ‰è½´å›é›¶"
      steps:
        - endpoint: "execute"
          request:
            text: "G28"
      response_template: "[green]ğŸ  å›é›¶å®Œæˆ[/]"

# æ•°æ®ç»‘å®šé…ç½®
bindings:
  status:
    source: "stream:poll_status"
    refresh_ms: 1000
    fields:
      x:
        path: "x"
        format: "F3"
      y:
        path: "y"
        format: "F3"
      z:
        path: "z"
        format: "F3"
      feed:
        path: "feed"
        format: "F0"
      speed:
        path: "speed"
        format: "F0"
      state:
        path: "state"
      alarm:
        path: "alarm"
      temp:
        path: "temp"
        format: "F1"

  meta:
    fields:
      model:
        path: "config.app.name"
      workspace:
        path: "config.app.version"
      branch:
        path: "status.state"

# å¸ƒå±€é…ç½®
layout:
  structure:
    type: "rows"
    children:
      - id: "header"
        size: 3
      - id: "body"
        ratio: 1
      - id: "footer"
        size: 4

  regions:
    header:
      content:
        type: "panel"
        title: "KCode v2 - REST Test Mode"
    body:
      content:
        type: "text"
        value: "ä¸»ä½“åŒºåŸŸ"
    footer:
      content:
        type: "text"
        value: "é¡µè„š"

# ä¸»é¢˜é…ç½®
theme:
  name: "Claude æš—è‰²"
  colors:
    primary: "#FF7043"
    secondary: "#4DD0E1"
    success: "#66BB6A"
    warning: "#FFEE58"
    error: "#EF5350"
  icons:
    enabled: true
