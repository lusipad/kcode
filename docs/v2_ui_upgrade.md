# KCode v2 UI å‡çº§è¯´æ˜

**æ›´æ–°æ—¥æœŸ**: 2025-11-28
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ¨ ç•Œé¢æ”¹è¿›

### âŒ æ—§ç‰ˆæœ¬ï¼ˆç®€å•æ¨¡å¼ï¼‰

```
KCode v2.0.0
é…ç½®é©±åŠ¨çš„å¤šåè®®å®¢æˆ·ç«¯

ä¼ è¾“: virtual
è¾“å…¥ help æŸ¥çœ‹å¸®åŠ©

X:0.000 Y:0.000 Z:0.000   F:0 S:0   â— IDLE | T:25.0Â°C

> _
```

**é—®é¢˜ï¼š**
- âŒ ç•Œé¢ç®€å•ï¼Œåªæœ‰ä¸€è¡ŒçŠ¶æ€
- âŒ ä½¿ç”¨ `AnsiConsole.Ask` è¾“å…¥ï¼ˆä¸æ”¯æŒéäº¤äº’æ¨¡å¼ï¼‰
- âŒ æ²¡æœ‰å†å²è®°å½•æ˜¾ç¤º
- âŒ æ²¡æœ‰å®æ—¶åˆ·æ–°
- âŒ æ²¡æœ‰å®Œæ•´çš„å¸ƒå±€ç³»ç»Ÿ

---

### âœ… æ–°ç‰ˆæœ¬ï¼ˆLive å®æ—¶åˆ·æ–°ç•Œé¢ï¼‰

```
â•­â”€ KCode v2.0.0 - é…ç½®é©±åŠ¨çš„å¤šåè®®å®¢æˆ·ç«¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ ä¼ è¾“: virtual | è¾“å…¥ help æŸ¥çœ‹å¸®åŠ©                          â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚ > help                                                  â”‚
â”‚ Available Commands:                                     â”‚
â”‚ System Commands:                                        â”‚
â”‚   help - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯                                    â”‚
â”‚   exit - é€€å‡ºç¨‹åº                                        â”‚
â”‚                                                         â”‚
â”‚ > G0 X10 Y20                                            â”‚
â”‚ âœ“ Virtual: Executed command 'G0 X10 Y20'               â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•­â”€ è¾“å…¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ > homeâ–ˆ                                                 â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

X:259.51 Y:38.25 Z:9.60   F:0 S:0   â— IDLE | T:31.4Â°C
BOT Sonnet 4.5   DIR KCode   BR main   TOK 0 tokens
```

**æ”¹è¿›ï¼š**
- âœ… å®Œæ•´çš„ Layout å¸ƒå±€ç³»ç»Ÿ
- âœ… å®æ—¶åˆ·æ–°ï¼ˆ60 FPSï¼‰
- âœ… å†å²è®°å½•é¢æ¿
- âœ… å®æ—¶çŠ¶æ€æ˜¾ç¤º
- âœ… è¾“å…¥å…‰æ ‡æ˜¾ç¤ºï¼ˆâ–ˆï¼‰
- âœ… æŒ‰é”®å®æ—¶å“åº”
- âœ… é¡µè„šå¾½ç« æ˜¾ç¤º

---

## ğŸ—ï¸ å¸ƒå±€ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header (8 è¡Œ)                           â”‚
â”‚  - æ¬¢è¿ä¿¡æ¯                               â”‚
â”‚  - ä¼ è¾“ç±»å‹                               â”‚
â”‚  - å¿«æ·æç¤º                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Body (è‡ªåŠ¨é«˜åº¦)                          â”‚
â”‚  - å‘½ä»¤å†å²                               â”‚
â”‚  - å‘½ä»¤è¾“å‡º                               â”‚
â”‚  - æ»šåŠ¨æ˜¾ç¤ºï¼ˆæœ€å¤š 50 æ¡ï¼‰                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Prompt (3 è¡Œ)                           â”‚
â”‚  - è¾“å…¥æç¤º >                             â”‚
â”‚  - å½“å‰è¾“å…¥å†…å®¹                            â”‚
â”‚  - å…‰æ ‡ â–ˆ                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Footer (4 è¡Œ)                           â”‚
â”‚  - çŠ¶æ€æ ï¼ˆX/Y/Z, Feed, Speed, Stateï¼‰    â”‚
â”‚  - å¾½ç« ï¼ˆModel, Workspace, Branch, etcï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. **å®æ—¶åˆ·æ–°**
```csharp
await Task.Delay(16); // 60 FPS
ctx.Refresh();
```
- ç•Œé¢æ¯ 16ms åˆ·æ–°ä¸€æ¬¡
- çŠ¶æ€å®æ—¶æ›´æ–°
- è¾“å…¥å³æ—¶æ˜¾ç¤º

### 2. **æŒ‰é”®å¤„ç†**
```csharp
var key = Console.ReadKey(true);

if (key.Key == ConsoleKey.Enter) { }
else if (key.Key == ConsoleKey.Backspace) { }
else if (key.KeyChar != '\0') { inputBuffer.Append(key.KeyChar); }
```
- ç›´æ¥è¯»å–æŒ‰é”®
- æ”¯æŒé€€æ ¼åˆ é™¤
- æ”¯æŒæ‰€æœ‰å¯æ‰“å°å­—ç¬¦

### 3. **å†å²è®°å½•**
```csharp
historyPanels.Add(new Markup($"[cyan]> {cmd}[/]"));
historyPanels.Add(new Markup(result.Output));

// é™åˆ¶æ•°é‡
while (historyPanels.Count > 50) {
    historyPanels.RemoveAt(0);
}
```
- è‡ªåŠ¨æ»šåŠ¨æ˜¾ç¤º
- æœ€å¤šä¿ç•™ 50 æ¡
- å‘½ä»¤å’Œè¾“å‡ºåˆ†å¼€æ˜¾ç¤º

### 4. **æ•°æ®ç»‘å®š**
```csharp
// BindingEngine è‡ªåŠ¨æ›´æ–° DataContext
await _bindingEngine.StartAsync();

// LayoutEngine ä» DataContext æ¸²æŸ“çŠ¶æ€
var statusBar = _layoutEngine.RenderStatusBar();
var badges = _layoutEngine.RenderFooterBadges();
```
- çŠ¶æ€å®æ—¶æ›´æ–°
- æ•°æ®é©±åŠ¨ UI
- è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤º

---

## ğŸ¨ è§†è§‰æ•ˆæœ

### é¢œè‰²ä¸»é¢˜
- **Header**: Cyanï¼ˆé’è‰²ï¼‰
- **Prompt**: Purpleï¼ˆç´«è‰²ï¼‰
- **Success**: Greenï¼ˆç»¿è‰²ï¼‰
- **Error**: Redï¼ˆçº¢è‰²ï¼‰
- **Status**: å¤šå½©ï¼ˆX/Y/Z ç´«è‰²ï¼ŒFeed/Speed é’è‰²ï¼ŒState ç»¿è‰²ï¼‰

### è¾¹æ¡†æ ·å¼
- **Header**: Roundedï¼ˆåœ†è§’ï¼‰
- **Prompt**: Roundedï¼ˆåœ†è§’ï¼‰
- **Body**: Noneï¼ˆæ— è¾¹æ¡†ï¼Œæ›´å®½æ•ï¼‰

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### å¯åŠ¨ v2 Live ç•Œé¢

```bash
cd kcode
dotnet run -- --v2
```

### äº¤äº’æ“ä½œ

- **è¾“å…¥å‘½ä»¤**: ç›´æ¥æ‰“å­—
- **æ‰§è¡Œå‘½ä»¤**: æŒ‰ Enter
- **åˆ é™¤å­—ç¬¦**: æŒ‰ Backspace
- **é€€å‡ºç¨‹åº**: è¾“å…¥ `exit` æˆ– `quit`
- **æŸ¥çœ‹å¸®åŠ©**: è¾“å…¥ `help`

### ç¯å¢ƒè¦æ±‚

âœ… **æ¨èç»ˆç«¯ï¼š**
- Windows Terminal
- PowerShell 7+
- ConEmu
- Cmder

âŒ **ä¸æ”¯æŒï¼š**
- Git Bashï¼ˆéƒ¨åˆ†åŠŸèƒ½å—é™ï¼‰
- WSL1ï¼ˆå¯èƒ½æœ‰é—®é¢˜ï¼‰
- é‡å®šå‘/ç®¡é“æ¨¡å¼

---

## ğŸ”§ æŠ€æœ¯å®ç°

### AnsiConsole.Live

```csharp
await AnsiConsole.Live(layout)
    .AutoClear(false)
    .StartAsync(async ctx =>
    {
        while (isRunning)
        {
            // å¤„ç†è¾“å…¥
            // åˆ·æ–°ç•Œé¢
            ctx.Refresh();
            await Task.Delay(16);
        }
    });
```

**ä¼˜åŠ¿ï¼š**
- çœŸæ­£çš„å®æ—¶åˆ·æ–°
- å¸ƒå±€ä¸é—ªçƒ
- æ€§èƒ½ä¼˜ç§€
- æ”¯æŒå¤æ‚å¸ƒå±€

### Layout System

```csharp
var layout = new Layout("root")
    .SplitRows(
        new Layout("header").Size(8),
        new Layout("body").Ratio(1),
        new Layout("prompt").Size(3),
        new Layout("footer").Size(4)
    );
```

**ç‰¹ç‚¹ï¼š**
- è‡ªé€‚åº”é«˜åº¦
- å›ºå®šåŒºåŸŸå¤§å°
- åµŒå¥—å¸ƒå±€æ”¯æŒ

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| åˆ·æ–°ç‡ | 60 FPS (16ms) |
| å†…å­˜å ç”¨ | < 50MB |
| CPU å ç”¨ | < 5% |
| è¾“å…¥å»¶è¿Ÿ | < 20ms |
| å†å²è®°å½• | æœ€å¤š 50 æ¡ |

---

## ğŸ¯ ä¸ v1 å¯¹æ¯”

| ç‰¹æ€§ | v1 | v2 |
|------|----|----|
| Live åˆ·æ–° | âœ… | âœ… |
| Layout å¸ƒå±€ | âœ… | âœ… |
| å†å²è®°å½• | âœ… | âœ… |
| çŠ¶æ€æ  | âœ… | âœ… |
| é¡µè„šå¾½ç«  | âœ… | âœ… |
| æ•°æ®ç»‘å®š | âŒ | âœ… |
| é…ç½®é©±åŠ¨ | éƒ¨åˆ† | âœ… |
| åè®®æ— å…³ | âŒ | âœ… |
| æ¨¡æ¿æ¸²æŸ“ | âŒ | âœ… |

---

## ğŸ”œ æœªæ¥æ”¹è¿›

- [ ] æ”¯æŒ Tab è‡ªåŠ¨è¡¥å…¨
- [ ] æ”¯æŒä¸Š/ä¸‹ç®­å¤´å†å²å¯¼èˆª
- [ ] æ”¯æŒæ›´å¤šå¿«æ·é”®ï¼ˆCtrl+C, Ctrl+L, etcï¼‰
- [ ] æ·»åŠ è¯­æ³•é«˜äº®
- [ ] æ·»åŠ å‘½ä»¤å»ºè®®
- [ ] æ”¯æŒå¤šè¡Œè¾“å…¥
- [ ] æ·»åŠ ä¸»é¢˜åˆ‡æ¢

---

**æ€»ç»“**: v2 ç°åœ¨å…·æœ‰ä¸ v1 ç›¸åŒçš„å®Œæ•´ Live ç•Œé¢ï¼ŒåŒæ—¶å¢åŠ äº†é…ç½®é©±åŠ¨ã€åè®®æ— å…³ã€æ•°æ®ç»‘å®šç­‰å¼ºå¤§åŠŸèƒ½ï¼

**æ¨è**: åœ¨ **Windows Terminal** æˆ– **PowerShell** ä¸­è¿è¡Œä»¥è·å¾—æœ€ä½³ä½“éªŒã€‚
