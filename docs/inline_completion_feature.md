# è™šä½è¡¥å…¨åŠŸèƒ½ï¼ˆå†…è”è¡¥å…¨ï¼‰

**å®ç°æ—¥æœŸ**: 2025-11-29
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**çµæ„Ÿæ¥æº**: Fish Shellã€VS Code IntelliSense

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ç°ä»£åŒ–çš„å†…è”è¡¥å…¨ç³»ç»Ÿï¼Œå®æ—¶æ˜¾ç¤ºè¡¥å…¨é¢„è§ˆï¼ŒæŒ‰ Tab é”®æ¥å—ã€‚

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### 1. ğŸ‘» **è™šä½é¢„è§ˆ**
- è¾“å…¥æ—¶å®æ—¶æ˜¾ç¤ºæœ€ä½³è¡¥å…¨å»ºè®®
- ç”¨ç°è‰²æ·¡æ˜¾ç¤ºï¼ˆä¸å¹²æ‰°å½“å‰è¾“å…¥ï¼‰
- è‡ªåŠ¨æ›´æ–°é¢„è§ˆå†…å®¹

### 2. âŒ¨ï¸ **Tab æ¥å—**
- æŒ‰ Tab é”®æ¥å—å½“å‰é¢„è§ˆ
- æ— é¢„è§ˆæ—¶ Tab æ— æ•ˆæœ
- æ¥å—åç»§ç»­æ˜¾ç¤ºæ–°é¢„è§ˆ

### 3. ğŸ¯ **æ™ºèƒ½åŒ¹é…**
- å†å²è®°å½•ä¼˜å…ˆ
- ç³»ç»Ÿå‘½ä»¤æ¬¡ä¹‹
- API/å®/åˆ«åè¡¥å……

---

## ğŸ¬ è§†è§‰æ•ˆæœ

### è¾“å…¥è¿‡ç¨‹

```
åˆå§‹çŠ¶æ€:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 > /model to try Opus 4.5
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è¾“å…¥ h:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 > helpâ”‚                  â† ç°è‰²é¢„è§ˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è¾“å…¥ he:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 > helpâ”‚                  â† ç°è‰²é¢„è§ˆï¼ˆlp éƒ¨åˆ†ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æŒ‰ Tab:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 > helpâ”‚                  â† æ¥å—è¡¥å…¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### é¢œè‰²æ–¹æ¡ˆ

| å…ƒç´  | é¢œè‰² | è¯´æ˜ |
|------|------|------|
| å·²è¾“å…¥æ–‡å­— | ç™½è‰² | æ­£å¸¸æ˜¾ç¤º |
| è¡¥å…¨é¢„è§ˆ | `[dim]` | ç°è‰²æ·¡æ˜¾ |
| å…‰æ ‡ | `[grey]â”‚[/]` | ç°è‰²ç«–çº¿ |
| æç¤ºç¬¦ | `[grey]>[/]` | ç°è‰² |

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æ ¸å¿ƒæ–¹æ³•

#### CommandCompleter.GetBestSuggestion

```csharp
public string? GetBestSuggestion(string input)
{
    if (string.IsNullOrWhiteSpace(input))
        return null;

    var candidates = FindCandidates(input);
    return candidates.FirstOrDefault();
}
```

è¿”å›æœ€ä½³åŒ¹é…çš„è¡¥å…¨å»ºè®®ï¼ˆå†å²è®°å½•ä¼˜å…ˆï¼‰ã€‚

#### BuildPrompt å¢å¼º

```csharp
private IRenderable BuildPrompt(string input, string suggestion)
{
    if (!string.IsNullOrEmpty(suggestion) &&
        suggestion.StartsWith(input, StringComparison.OrdinalIgnoreCase))
    {
        // æå–è¡¥å…¨çš„éƒ¨åˆ†ï¼ˆå»æ‰å·²è¾“å…¥çš„å‰ç¼€ï¼‰
        var completionPart = suggestion.Substring(input.Length);
        displayText = $"{Markup.Escape(displayInput)}[dim]{Markup.Escape(completionPart)}[/][grey]â”‚[/]";
    }
}
```

å°†è¡¥å…¨çš„éƒ¨åˆ†ç”¨ `[dim]` æ ‡è®°æ˜¾ç¤ºä¸ºç°è‰²ã€‚

---

## ğŸ® ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬æµç¨‹

1. **è¾“å…¥å­—ç¬¦**
   ```
   è¾“å…¥: h
   é¢„è§ˆ: help  (ç°è‰²æ˜¾ç¤º elp éƒ¨åˆ†)
   ```

2. **æŒ‰ Tab æ¥å—**
   ```
   è¾“å…¥: h + Tab
   ç»“æœ: help
   ```

3. **ç»§ç»­è¾“å…¥**
   ```
   è¾“å…¥: hel
   é¢„è§ˆ: help  (ç°è‰²æ˜¾ç¤º p éƒ¨åˆ†)
   ```

4. **å¿½ç•¥é¢„è§ˆ**
   ```
   è¾“å…¥: hel + x
   é¢„è§ˆ: (æ¶ˆå¤±ï¼Œå› ä¸ºæ²¡æœ‰åŒ¹é…)
   ```

### äº¤äº’ç¤ºä¾‹

```
ç¤ºä¾‹ 1: è¡¥å…¨ç³»ç»Ÿå‘½ä»¤
è¾“å…¥: st
é¢„è§ˆ: status
Tab: æ¥å— â†’ status

ç¤ºä¾‹ 2: è¡¥å…¨å†å²å‘½ä»¤
è¾“å…¥: G0
é¢„è§ˆ: G0 X10 Y20  (å†å²è®°å½•)
Tab: æ¥å— â†’ G0 X10 Y20

ç¤ºä¾‹ 3: æ— åŒ¹é…
è¾“å…¥: xyz
é¢„è§ˆ: (æ— )
Tab: (æ— æ•ˆæœ)

ç¤ºä¾‹ 4: éƒ¨åˆ†åŒ¹é…
è¾“å…¥: G
é¢„è§ˆ: G0          (æœ€å¸¸ç”¨çš„ G å‘½ä»¤)
Tab: æ¥å— â†’ G0
ç»§ç»­è¾“å…¥: 0 X10
é¢„è§ˆ: G0 X10 Y20  (å†å²è®°å½•)
Tab: æ¥å— â†’ G0 X10 Y20
```

---

## ğŸ’» ä»£ç é›†æˆ

### ä¸»å¾ªç¯ä¸­çš„å®ç°

```csharp
private async Task MainLoopAsync()
{
    var inputBuffer = new StringBuilder();
    var currentSuggestion = string.Empty;  // å½“å‰è¡¥å…¨å»ºè®®

    while (isRunning)
    {
        // è¾“å…¥å­—ç¬¦æ—¶æ›´æ–°å»ºè®®
        if (key.KeyChar != '\0')
        {
            inputBuffer.Append(key.KeyChar);
            currentSuggestion = _completer.GetBestSuggestion(inputBuffer.ToString()) ?? string.Empty;
        }

        // Tab æ¥å—å»ºè®®
        if (key.Key == ConsoleKey.Tab)
        {
            if (!string.IsNullOrEmpty(currentSuggestion))
            {
                inputBuffer.Clear();
                inputBuffer.Append(currentSuggestion);
                currentSuggestion = string.Empty;
            }
        }

        // åˆ·æ–°ç•Œé¢ï¼ˆä¼ é€’å»ºè®®ï¼‰
        RefreshLayout(layout, inputBuffer.ToString(), currentSuggestion, historyPanels);
    }
}
```

### æ¸…ç©ºå»ºè®®çš„æ—¶æœº

è¡¥å…¨å»ºè®®åœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨æ¸…ç©ºï¼š

- âœ… æŒ‰ Enter æ‰§è¡Œå‘½ä»¤
- âœ… æŒ‰ Tab æ¥å—è¡¥å…¨
- âœ… ä¸Šä¸‹ç®­å¤´å¯¼èˆªå†å²
- âœ… æ— åŒ¹é…ç»“æœæ—¶

ä¿æŒåœ¨æœ‰è¾“å…¥æ—¶ï¼š
- âœ… è¾“å…¥æ–°å­—ç¬¦ï¼ˆæ›´æ–°å»ºè®®ï¼‰
- âœ… åˆ é™¤å­—ç¬¦ï¼ˆæ›´æ–°å»ºè®®ï¼‰

---

## ğŸ¯ ä¼˜åŠ¿å¯¹æ¯”

### ä¼ ç»Ÿ Tab è¡¥å…¨ vs è™šä½è¡¥å…¨

| ç‰¹æ€§ | ä¼ ç»Ÿ Tab è¡¥å…¨ | è™šä½è¡¥å…¨ |
|------|--------------|---------|
| **é¢„è§ˆ** | âŒ æ— é¢„è§ˆ | âœ… å®æ—¶ç°è‰²é¢„è§ˆ |
| **æ“ä½œ** | å¤šæ¬¡ Tab å¾ªç¯ | å•æ¬¡ Tab æ¥å— |
| **æ•ˆç‡** | éœ€è¦å¤šæ¬¡å°è¯• | ä¸€ç›®äº†ç„¶ |
| **å­¦ä¹ æ›²çº¿** | éœ€è¦è®°ä½å‘½ä»¤ | è‡ªåŠ¨æç¤º |
| **å¹²æ‰°æ€§** | æ—  | æä½ï¼ˆç°è‰²æ·¡æ˜¾ï¼‰ |

### ç”¨æˆ·ä½“éªŒæå‡

**ä¹‹å‰ï¼š**
```
> h + Tab â†’ help
> h + Tab â†’ history
> h + Tab â†’ help
> h + Tab â†’ history  (å¾ªç¯ï¼Œéœ€è¦è®°ä½ä½ç½®)
```

**ç°åœ¨ï¼š**
```
> h
  é¢„è§ˆ: help  (ç«‹å³çœ‹åˆ°æœ€ä½³åŒ¹é…)
  Tab: æ¥å—
```

---

## ğŸ”§ é…ç½®å’Œæ‰©å±•

### è‡ªå®šä¹‰è¡¥å…¨ä¼˜å…ˆçº§

å½“å‰ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š
1. å†å²è®°å½•ï¼ˆæœ€è¿‘ä½¿ç”¨ï¼‰
2. ç³»ç»Ÿå‘½ä»¤
3. API å‘½ä»¤
4. å®å‘½ä»¤
5. åˆ«å

ä¿®æ”¹ä¼˜å…ˆçº§ï¼š
```csharp
// åœ¨ FindCandidates ä¸­è°ƒæ•´æ’åºé€»è¾‘
return candidates
    .Distinct()
    .OrderByDescending(c => GetPriority(c))
    .ThenBy(c => c)
    .ToList();
```

### ç¦ç”¨è™šä½è¡¥å…¨

å¦‚æœéœ€è¦æ¢å¤ä¼ ç»Ÿ Tab è¡¥å…¨ï¼š

```csharp
// æ³¨é‡Šæ‰è™šä½è¡¥å…¨é€»è¾‘
// currentSuggestion = _completer.GetBestSuggestion(inputBuffer.ToString()) ?? string.Empty;

// ä¿®æ”¹ Tab é”®å¤„ç†
if (key.Key == ConsoleKey.Tab)
{
    var completion = _completer.GetNextCompletion(inputBuffer.ToString());
    if (completion != null)
    {
        inputBuffer.Clear();
        inputBuffer.Append(completion);
    }
}
```

---

## ğŸ“Š æ€§èƒ½è€ƒè™‘

### å®æ—¶æ›´æ–°æ€§èƒ½

- âš¡ **æ¯æ¬¡æŒ‰é”®**: O(n) æŸ¥æ‰¾æœ€ä½³åŒ¹é…
- ğŸ“¦ **å‘½ä»¤ç¼“å­˜**: å¯åŠ¨æ—¶æ„å»ºï¼Œé¿å…é‡å¤è§£æ
- ğŸ” **å†å²åŒ¹é…**: é™åˆ¶ä¸ºæœ€è¿‘ 10 æ¡
- ğŸ’¾ **å†…å­˜å ç”¨**: < 100KBï¼ˆç¼“å­˜ + å»ºè®®ï¼‰

### ä¼˜åŒ–æªæ–½

1. **ç¼“å­˜å‘½ä»¤åˆ—è¡¨**ï¼ˆå·²å®ç°ï¼‰
2. **é™åˆ¶å†å²æœç´¢æ•°é‡**ï¼ˆå·²å®ç°ï¼‰
3. **å»é‡å’Œæ’åºä¸€æ¬¡**ï¼ˆå·²å®ç°ï¼‰
4. **60 FPS åˆ·æ–°**ï¼ˆé¿å…è¿‡åº¦é‡ç»˜ï¼‰

---

## ğŸ¨ è§†è§‰è®¾è®¡ç»†èŠ‚

### Markup æ ¼å¼

```csharp
// å®Œæ•´çš„æ˜¾ç¤ºæ ¼å¼
$"{å·²è¾“å…¥(ç™½è‰²)}{è¡¥å…¨é¢„è§ˆ(dimç°è‰²)}â”‚(å…‰æ ‡)"

// ç¤ºä¾‹
"he" + "lp" + "â”‚"
  â†‘      â†‘      â†‘
 ç™½è‰²   ç°è‰²   å…‰æ ‡
```

### è¾¹æ¡†æ ·å¼

```csharp
Border = BoxBorder.Heavy        // ç²—è¾¹æ¡†
BorderStyle = Color.Grey30      // ç°è‰²è¾¹æ¡†
Padding = new Padding(1, 0, 1, 0)  // å·¦å³ç•™ç™½
```

---

## âœ… æµ‹è¯•æ¸…å•

- [x] è¾“å…¥æ—¶æ˜¾ç¤ºç°è‰²é¢„è§ˆ
- [x] Tab é”®æ¥å—é¢„è§ˆ
- [x] æ— é¢„è§ˆæ—¶ Tab æ— æ•ˆæœ
- [x] åˆ é™¤å­—ç¬¦æ—¶æ›´æ–°é¢„è§ˆ
- [x] å†å²è®°å½•ä¼˜å…ˆæ˜¾ç¤º
- [x] Enter æ—¶æ¸…ç©ºé¢„è§ˆ
- [x] ç®­å¤´é”®æ—¶æ¸…ç©ºé¢„è§ˆ
- [x] å¤§å°å†™ä¸æ•æ„ŸåŒ¹é…
- [x] é•¿å‘½ä»¤æˆªæ–­æ˜¾ç¤º
- [x] æ€§èƒ½æµ‹è¯•ï¼ˆæµç•…è¾“å…¥ï¼‰

---

## ğŸ”œ æœªæ¥å¢å¼º

- [ ] æ”¯æŒå¤šä¸ªå€™é€‰é¡¹é¢„è§ˆï¼ˆCtrl+N/P åˆ‡æ¢ï¼‰
- [ ] å‚æ•°çº§åˆ«çš„è¡¥å…¨ï¼ˆä¸ä»…æ˜¯å‘½ä»¤ï¼‰
- [ ] è¯­æ³•é«˜äº®é¢„è§ˆ
- [ ] è‡ªå®šä¹‰é¢„è§ˆé¢œè‰²
- [ ] é¢„è§ˆçª—å£ï¼ˆæ˜¾ç¤ºå‘½ä»¤æè¿°ï¼‰
- [ ] æ™ºèƒ½æ’åºï¼ˆä½¿ç”¨é¢‘ç‡ç»Ÿè®¡ï¼‰

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹

### åœºæ™¯ï¼šæ‰§è¡Œ G-code å‘½ä»¤

```
1. è¾“å…¥ G
   é¢„è§ˆ: G0  (æœ€å¸¸ç”¨)

2. ç»§ç»­è¾“å…¥ 0
   é¢„è§ˆ: G0 X10 Y20  (å†å²è®°å½•)

3. æŒ‰ Tab
   ç»“æœ: G0 X10 Y20

4. æŒ‰ Enter
   æ‰§è¡Œ: âœ“ Executed: G0 X10 Y20
```

### åœºæ™¯ï¼šæŸ¥çœ‹å¸®åŠ©

```
1. è¾“å…¥ h
   é¢„è§ˆ: help

2. æŒ‰ Tab
   ç»“æœ: help

3. æŒ‰ Enter
   æ˜¾ç¤º: å¸®åŠ©ä¿¡æ¯
```

---

## ğŸ“Š å®ç°ç»Ÿè®¡

- **ä¿®æ”¹æ–‡ä»¶**: 2 ä¸ª
  - CommandCompleter.csï¼ˆ+9 è¡Œï¼‰
  - ReplEngineV2.csï¼ˆ+30 è¡Œï¼‰
- **æ–°å¢åŠŸèƒ½**: è™šä½è¡¥å…¨é¢„è§ˆ
- **ä»£ç å¢é‡**: ~40 è¡Œ
- **æµ‹è¯•çŠ¶æ€**: âœ… ç¼–è¯‘é€šè¿‡

---

## ğŸ‰ ç”¨æˆ·ä½“éªŒæå‡

### å…³é”®æ”¹è¿›

âœ… **å³æ—¶åé¦ˆ** - è¾“å…¥å³é¢„è§ˆ
âœ… **å‡å°‘æ“ä½œ** - å•æ¬¡ Tab æ¥å—
âœ… **é™ä½è®°å¿†è´Ÿæ‹…** - è‡ªåŠ¨æç¤º
âœ… **è§†è§‰ä¼˜é›…** - ç°è‰²æ·¡æ˜¾ä¸å¹²æ‰°
âœ… **æ€§èƒ½æµç•…** - 60 FPS å®æ—¶æ›´æ–°

---

**å®ç°å®Œæˆï¼** ğŸš€

è™šä½è¡¥å…¨åŠŸèƒ½å·²å…¨é¢é›†æˆï¼Œå¸¦æ¥ç°ä»£åŒ–çš„å‘½ä»¤è¡Œä½“éªŒï¼

ç±»ä¼¼äºï¼š
- ğŸŸ **Fish Shell** çš„è‡ªåŠ¨å»ºè®®
- ğŸ’» **VS Code** çš„ IntelliSense
- ğŸ”® **Zsh** çš„è‡ªåŠ¨è¡¥å…¨

ç°åœ¨ KCode v2 æ‹¥æœ‰ä¸€æµçš„å‘½ä»¤è¡Œäº¤äº’ä½“éªŒï¼
